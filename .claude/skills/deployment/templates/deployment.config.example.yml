# ProAgentic DfX Deployment Configuration Template
#
# This is a reference configuration file for the H2 Tank Designer project.
# Actual deployment is managed by GitHub Actions and Vercel.
#
# GitHub Secrets Required (set in repository settings):
#   - VERCEL_TOKEN       (Vercel API token)
#   - VERCEL_ORG_ID      (Vercel organization ID)
#   - VERCEL_PROJECT_ID  (Vercel project ID)

# Project Identifier
project: proagentic-dfx
description: H2 Tank Designer - AI-powered engineering design platform

# Deployment Configuration
deployment:
  type: frontend-only
  provider: vercel

  # No backend in this project
  # Mock server (h2-tank-mock-server) is for local development only
  backend: null

# Environment Configurations
environments:
  production:
    branch: main
    url: https://dfx.proagentic.ai
    auto_deploy: true
    vercel_args: "--prod"

  staging:
    branch: staging
    url: https://proagentic-dfx-staging.vercel.app
    auto_deploy: true

  preview:
    trigger: pull_request
    url_pattern: "https://{deployment-id}.vercel.app"
    auto_deploy: true
    comment_on_pr: true

# CI/CD Pipeline Quality Gates
quality_gates:
  file_sizes:
    enabled: true
    command: "node scripts/check-file-sizes.mjs all"
    required: always
    limits:
      components: 500  # lines
      types: 800       # lines
      tests: 800       # lines

  lint:
    enabled: true
    command: "npm run lint"
    required: always

  typecheck:
    enabled: true
    command: "npx tsc --noEmit"
    required: always

  unit_tests:
    enabled: true
    command: "npm run test:coverage"
    required: always
    coverage_threshold: 80

  build:
    enabled: true
    command: "npm run build"
    required: always
    env:
      NEXT_TELEMETRY_DISABLED: 1

  mock_server_tests:
    enabled: true
    command: "cd h2-tank-mock-server && npm test"
    required: always

  e2e_tests:
    enabled: true
    command: "npm run test:e2e"
    required_for:
      - pull_request_to_main
      - production

  security_audit:
    enabled: true
    command: "npm audit --audit-level=high"
    required: false  # Non-blocking

# Build Configuration
build:
  node_version: "20"
  install_command: "npm install"
  build_command: "npm run build"
  output_directory: ".next"

# GitHub Actions Workflow
github_actions:
  workflow_file: ".github/workflows/ci.yml"

  concurrency:
    group: "${{ github.workflow }}-${{ github.ref }}"
    cancel_in_progress: true

  artifacts:
    coverage:
      path: "proagentic-dfx/coverage/"
      retention_days: 7
    build:
      path: "proagentic-dfx/.next/"
      retention_days: 1
    playwright:
      path: "proagentic-dfx/playwright-report/"
      retention_days: 7

# Rollback Configuration
rollback:
  enabled: true
  methods:
    dashboard: "Vercel Dashboard → Deployments → Promote previous version"
    cli: "vercel rollback <deployment-url>"

# Local Development
local:
  dev_command: "npm run dev"
  dev_port: 3000
  mock_server:
    directory: h2-tank-mock-server
    command: "npm start"
    port: 8080

# Time Estimates (for planning)
timing:
  file_sizes: "~5s"
  lint_typecheck: "~35s"
  unit_tests: "~2-3min"
  build: "~1-2min"
  mock_server_tests: "~30s"
  e2e_tests: "~3-5min"
  vercel_deploy: "~1-2min"
  total: "~8-14min"

# Notes for Future Developers
#
# Migration from Old Setup:
# - This project previously used Netlify + Cloud Run
# - Now uses Vercel for frontend-only deployment
# - Old configs archived in: .claude/skills/deployment/archive/
#
# Adding a Backend Later:
# - Create API routes in Next.js (they deploy to Vercel serverless)
# - Or set up separate backend service (Cloud Run, Railway, etc.)
# - Update this config and CI workflow accordingly
#
# Custom Domains:
# - Configured in Vercel Dashboard → Settings → Domains
# - DNS records managed separately
#
# Environment Variables:
# - Set in Vercel Dashboard → Settings → Environment Variables
# - Or via Vercel CLI: vercel env add
